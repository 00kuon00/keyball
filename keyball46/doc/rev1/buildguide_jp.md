# Build Guide for Keyball46

こちらは Keyball46 のビルドガイドになります。

![01](images/yw001.jpg)

## 部品

キットが届きましたらキット同梱品がすべて入っていたかご確認ください。

### キット同梱品

| 名前 | 数 | 備考 |
|:-|:-|:-|
| PCB(左右) | １組 | |
| トップPCBプレート(左右) | １組 | |
| ボトムアクリルプレート(左右) | １組 | |
| ProMicro保護プレート(左右) | １組 | |
| トラックボール保持ケース白(上下) | １組 | |
| Φ2 セラミックボール | ５個 | （予備２個） |
| トラックボール読取り基板 | １枚 | |
| L字コンスルーピン(7ピン) | １個 | |
| トラックボール読取りIC | １個 | |
| 読取りIC用レンズ | １個 | |
| 平頭ネジ M1.7 | ２本 | |
| 小頭ネジ M1.7 | ２本 | |
| TRRSジャック | ２個 | |
| タクトスイッチ | ２個 | |
| ダイオード（チップタイプ） | ５２個＋ | リードタイプにも対応(オプション) |
| Kailh PCBソケット | ５０個 | |
| OLEDモジュール | １枚 | |
| 4連ピンヘッダ  | ２つ | |
| 4連ピンソケット | ２つ | |
| スペーサー M2 7mm | １５本 | |
| スペーサー M2 9mm | ５本 | |
| ネジ M2 3.5mm | ３８本＋ | |
| クッションゴム | ８個 | |

![02](images/yw002.jpg)

### 組立前にお客様自身で準備いただく部品

| 名前 | 数 | 備考 |
|:-|:-|:-|
| ProMicro | ２個 | 安価なものやUSB Type-C対応のもの等選べます |
| キースイッチ | ４６個 | CherryMX互換のもの |
| 直径34mmトラックボール | １個 | 動作確認で使用します |
| TRS(3極)ケーブル | １本 | TRRS(4極)ケーブルでも可 |
| Micro USBケーブル | １本 | ご購入いただいたProMicroに対応するもの |

![03](images/yw003.jpg)

### 組立後でも取り付けられる部品とオプション

| 名前 | 数 | 備考 |
|:-|:-|:-|
| キーキャップ | ４６個 | 1u ４５個、1.25u １個 |
| YS-SK6812MINI-E | １４個 | アンダーグロー用　※SK6812MINIは使用できません |

![04](images/yw004.jpg)


## 準備

### 必要な工具

Keyball46の組み立てには下記の工具とエポキシボンドが必要です。

| 名前 |
|:-|
| はんだごて(LEDを実装する場合は温度調整可能なもの) |
| はんだ(LEDを実装する場合は低融点のものが有効) |
| ニッパー |
| ０番＋精密ドライバー |
| ピンセット |
| エポキシボンド |
| つまようじ |

![05](images/yw005.jpg)

### ファームウェア

ProMicroへ直接書き込めるhexファイルのダウンロードページは準備中です。
QMK_Firmware/keyboards/keyballよりKeyball46用のファームウェアをmakeできるように準備中です。


## トラックボールケースの組み立て

トラックボールケースの組み立てにはエポキシボンドを使用します。
ボンドが乾くまで時間がかかるため、この作業を最初に行います。

まずエポキシボンドの２液を混ぜ合わせる環境を準備します。
この工程で使用するのはトラックボールケースの下側とφ2mmセラミックボールです。

![06](images/yw006.jpg)

ボンドを塗布するのは下写真の赤丸部３か所です。
セラミックボールを固定する穴内にごく少量を塗ります。

![10](images/yw010.jpg)

少量のエポキシボンドをトレーに出します。

![11](images/yw011.jpg)

適当なヘラで混ぜ合わせます。

![12](images/yw012.jpg)

つまようじの先にごく少量のエポキシボンドを取ります。  

![13](images/yw013.jpg)

まず、①の穴の底面にボンドをつけます。ごく少量で大丈夫です。  
次に②③の溝にもボンドを付けますが、赤点で示す背面側に塗ります。こちらもごく少量です。  

![14](images/yw014.jpg)

ボンド塗布後は、直径2mmのセラミックボールを各穴に入れていきます。  
３つのボールはすべて、上から落とすようにして入れますが跳ねてしまわないように静かに入れてください。  
途中でボールが回転するとボンドが付着した面が表に出てきてしまいトラックボールの動きが悪くなってしまいます。  

![15](images/yw015.jpg)

ボールを指で軽く押さえて底面、背面に位置を合わせます。  
これでセラミックボール３つが最適な位置に固定されます。  

![16](images/yw016.jpg)

セラミックボール表面がボンドで汚れていないか確認します。  
もしボンドが表面についている場合、思い切ってそのセラミックボールは捨てて、 
新しいセラミックボールを挿入してください。キットには予備のセラミックボールが含まれています。 
問題なければこの状態でボンドが固まるまで放置します。

![17](images/yw017.jpg)


## 実装

ここからはんだ付け作業に入ります。  
PCBはリバーシブルになっているので、最初にどちらを左手用/右手用にするか決めます。  

赤丸で示した、PCBが欠けている部分にトラックボールがつきます。  
右手親指でトラックボールを操作するなら下写真のような配置になります。  

![20](images/yw020.jpg)

左手でトラックボールを操作する場合は下写真のような配置です。 

![21](images/yw021.jpg)

本ビルドガイドでは右手にトラックボールをつける仕様で説明します。  
下記のようにPCBを置き、ミス防止のため表面にマスキングテープを貼ります。

![22](images/yw022.jpg)

### はんだ付けの前に
半田ごての”こて先”は竹槍の先端のような形状のものだと平面にはんだを乗せたり、余分なはんだを”すくい取る”事が出来るので使いやすいです。

![27](images/yw027.jpg)

### ダイオードの取り付け
それではダイオードを順にはんだ付けしていきます。  
ダイオードはすべて【裏面】にはんだ付けします。  
  
ダイオードのシルクマークは下写真の矢印のようなマークで、左右合計で48個あります。  
ダイオードには極性がありますので、正しい向きで取り付けてください。向きは部品上の直線とシルクマークの矢印の先についている直線が一致する方向です。  
  
下写真をよく見て向きを確認してください。  
同一基板上のダイオードの向きは90度回転して配置されているダイオードを除き、すべて同じ向きで配置されています。半田付けを進める中で回りのダイオードと同じ向きになっているか確認しながら行ってください。

![25](images/yw025.jpg)

キットには含まれませんが、リードタイプのダイオードも取付けられるように設計されています。（ただしロープロファイル(choc)仕様で組み立てる場合、トッププレートと干渉するためリードタイプは使用できません）  
  
表面実装タイプのダイオードは、慣れてくると早く作業ができますが、ピンセットで挟んだ状態で基板上に静止させる必要があり、確かに難易度が高いです。どちらでもお好みのタイプをご使用ください。  
  
リードタイプを使用する場合、極性は下記のように部品に記された帯マークとシルクマークの直線が同じ向きを向くように付けます。

![26](images/yw026.jpg)

それでは半田付け開始です。まず、ダイオード用パッドの片側にはんだを盛ります。

![28](images/yw028.jpg)

ピンセットでダイオードを掴み、事前に盛ったはんだを溶かしながらダイオードを固定します。

![30](images/yw030.jpg)

基板を180度回転させてダイオードの反対側の足へもはんだを流します。
最後に両方の足をこて先で触り、ダイオードが脱落しなければ両足とも半田付けされています。

![31](images/yw031.jpg)

リードタイプのダイオードを使用する場合には、シルクの一つ外側のスルーホールに足を通します。

![32](images/yw032.jpg)

リードタイプのはんだ付けは表面から行います。

![33](images/yw033.jpg)

はんだ付けしたら余計な足をカットします。  
表面にはんだの盛り上がりが残るため、ロープロファイル(choc)仕様で組み立てる場合にはリードタイプは使用できません。  
また親指キーのみロープロファイルにする場合には、親指キーだけは表面実装タイプをはんだ付けしてください。

![34](images/yw034.jpg)

右手基板には２４個のダイオードを取り付けます。

![37](images/yw037.jpg)

左手基板へも同様に作業します。こちらも２４個取り付けます。  
私もよく取付忘れや片側だけはんだ付けされていなかったということがありますので、数を数えてご確認ください。

![38](images/yw038.jpg)


### ジャンパのはんだ付け
OLEDモジュールとトラックボールセンサを動作させるためにジャンパをショートさせる必要があります。  j
ジャンパは__【裏面のみ】__に行います。  
"Back Side Only"の表示があり、右手基板には計【８個】あります。  
パッドをこて先で温めてはんだを溶かすとブリッジできます。

![40](images/yw040.jpg)

はんだの鮮度が落ちると表面張力が落ちてうまくブリッジできません。  
一度はんだを払ってしまい、はんだやフラックスを足してやり直してください。

![41](images/yw041.jpg)

左手基板もジャンパするのは【裏面のみ】です。  
【４個】ジャンパします。  
左手基板にはこの４個以外にもジャンパパッドがありますが、これらは現状使用しませんのではんだ付けの必要はありません。

![42](images/yw042.jpg)

### 4連ピンソケット・TRRSソケット・タクトスイッチ
下記写真の部品をのはんだ付けします。  
すべて【表面】に取付けます。  

![51](images/yw051.jpg)

部品が浮いてしまうのが心配であれば、マスキングテープで固定してはんだ付けします。

![52](images/yw052.jpg)



![53](images/yw053.jpg)

### ProMicroのはんだ付け
ProMicroは下記写真のコンスルーピンを使用してはんだ付けすることで、交換が可能になります。コンスルーピンには取付け方向がありますので写真をよく見て作業してください。

![60](images/yw060.jpg)

まずコンスルーピンを右手基板に差し込みます。

![61](images/yw061.jpg)

差し込んだコンスルーピンにProMicroを挿入します。  
この状態でProMicro側のみはんだ付けします。

![63](images/yw063.jpg)

基板に差し込んだ状態ではんだ付けすることで、コンスルーピンが斜めに取り付けられてしまうことを防げます。

![64](images/yw064.jpg)

左手基板も同様にはんだ付けします。

![65](images/yw065.jpg)

左手基板には標準でOLEDが搭載できます。  
4連ピンソケットに4連ピンヘッダを挿入してOLEDモジュールを載せます。

![70](images/yw070.jpg)

4ピンのうちのひとつだけをはんだ付けします。  
そのはんだを溶かしながらOLEDモジュールを上から押して浮かないようにします。またProMicroと並行になるように調整すると見栄えが良くなります。


![71](images/yw071.jpg)

位置が決まったら残り3ピンをはんだ付けします。

![72](images/yw072.jpg)

### ProMicoの書き込みと動作確認
QMK_Firmware内のkeyball:defaultをmakeします。  
作成したhexファイルをQMK_Toolboxを使用してProMicroへ書き込みます。  
下写真のようにキースイッチのパッドをピンセットでショートして動作確認します。  
早い段階で動作確認をすることで問題の切り分けが楽になります。

![75](images/yw075.jpg)

テキストエディタに文字が入力されることを確認します。

![76](images/yw076.jpg)

### アンダーグロー用LED（オプション）のはんだ付け
LED（YS-SK6812MINI-E）はオプションになります。左右で計14個取り付け可能です。  
ただしLEDは非常に熱に弱く、こて先温度を220度～280度に調整して行ってください。  
こて先温度が低いためパッドに熱が伝わらずテンプラしやすいです。  
LED無しでもキーボードは使用できますし、難易度が高いのでまずはLEDなしで完成させることをおすすめします。後からでもLEDを追加できます。  
  
YS-SK6812MINI-Eの４ピンのうち切り欠きがある足と、マーキングされているパッドを合わせます。

![80](images/yw080.jpg)

下写真のような状態ではんだ付けします。  
一度に４ピンすべてのはんだ付けをすると部品の温度が上がり壊れやすいので、２ピンづつくらいで時間をあけてはんだ付けしてください。

![81](images/yw081.jpg)

はんだ付けが完了したら点灯を確認します。  
LEDは直列に配線されているので、途中までしか点灯しない場合はそのLEDとその両隣のLEDのはんだ付けや、LEDを交換して修正してください。  
７つすべて点灯すると下写真のようになります。  
  
また、青丸部のようにはんだカスが基板や別のパッドについた場合、こて先の温度が低いと除去しにくいので、気にせず作業を進め、こて先温度を上げた後で撫でれば簡単に除去できます。

![82](images/yw082.jpg)

### キーソケットのはんだ付け
キーソケットをシルクマークと形状が合うようにセットしてはんだ付けします。  
シルクからはみ出すようであれば方向が違います。

![85](images/yw085.jpg)

青丸で示すように事前にソケットようパッドにはんだを盛っておきます。

![86](images/yw086.jpg)

ソケットをはめて上からピンセットで抑えて端子の横からはんだを少し載せたこて先を当てると、はんだが溶けてソケットが沈み込みます。  
経験上、この方法が一番テンプラ（接続不良）しにくいです。  

基板を180度回転させて反対側の端子も同様にはんだ付けします。

![87](images/yw087.jpg)

ロープロファイルソケット（kailh choc）を使用する場合は下写真のようになります。

![88](images/yw088.jpg)

左右合わせて46個はんだ付けして完了です。

![89](images/yw089.jpg)

### ボール読み取り基板の組み立て
下写真の基板（以下、ボール基板）とセンサーを準備します。

![90](images/yw090.jpg)

センサーICはボール基板の部品が実装されていない裏面から差し込みます。  
ICの１ピンを示すくぼみと基板のパッドマークを合わせます。

![91](images/yw091.jpg)

ICを裏から見るとこのような方向です。部品が実装されている表面から全ピンをはんだ付けしてください。

![92](images/yw092.jpg)

ピンセットを使って保護シール【２枚】をはがします。

![93](images/yw093.jpg)

シールをはがした面にセンサーレンズを取付けます。

![94](images/yw094.jpg)

レンズには方向があります。  
レンズ手前に下写真矢印のような突起があり、これが上側にくるように取り付けます。

![95](images/yw095.jpg)

次にL字コンスルーピンを右手基板【表面】に取付けます。  
L字コンスルーにも方向があり、下写真と同じように取り付けてください。  
ピンがU字型になっていない方をはんだ付けします。

![96](images/yw096.jpg)

部品が浮かないようにマスキングテープを貼ってはんだ付けしてください。

![97](images/yw097.jpg)

以上ではんだ付け作業は完了です。

余談ですがはんだごての電気を落とす前に、こて先にたっっぷりとはんどを付けておきましょう。次回使用するときにこのはんだを落とせば、ピカピカのこて先で作業を再開できますよ！

![100](images/yw100.jpg)

Keyball46は親指キーのみロープロファイルにすることが可能です。  
そのためにはミシン目をカットします。  
高さを変える必要がない場合は切り取る必要はありません。  
  
切り取るには大き目のニッパでミシン目に傷をつけます。  

![101](images/yw101.jpg)

カッターで少しづつ切り込みを増やしていくと切り離すことができます。

![102](images/yw102.jpg)

左右両方とも切り離すことができました。

![103](images/yw103.jpg)


150番くらいのやすりでバリを取ります。

![104](images/yw104.jpg)

ミドル基板にProMicro保護プレートを取り付けます。
まず9mmスペーサをねじ止めします。

![110](images/yw110.jpg)

アクリル保護プレートをねじ止めします。右手はスペーサ３つ、左手はスペーサ２つで固定します。

![111](images/yw111.jpg)

トッププレートの【裏面】に7mmスペーサ（ロープロファイル仕様なら4mmスペーサ）をねじ止めします。

![112](images/yw112.jpg)

トッププレートの四隅にキースイッチをはめ込みます。こうするとプレート同士の位置決め精度が上がります。

![113](images/yw113.jpg)

トッププレートとミドルプレートのねじ穴を合わせ、キースイッチの端子がしっかりキーソケットに入ることを確認しながらプレート同士を重ねます。

![114](images/yw114.jpg)

裏面からアクリルボトムプレートを重ねてねじ止めします。ねじは左右とも７本です。

![115](images/yw115.jpg)

組み立てたトラックボール読み取り基板を７ピンコンスルーへ差し込みます。わかりやすいように斜めにしていますが、基板は垂直にして差し込みます。

![120](images/yw120.jpg)

ボール基板が垂直に立ちました。

![121](images/yw121.jpg)

作業の初めにボンド付けしたセラミックボールを確認します。軽く振っても落下しないようなら組み立てに入ります。  
落ちてしまうようなら再度ボンド付けをします。セラミックボールの予備は今後ボールを紛失した時のために保管しておいてください。

![122](images/yw122.jpg)

ケース下の穴へ、ケース上のピン２本が挿入できます。  
上下からゆっくり力を入れて結合します。（ぴったりと結合しなくてもこの後のねじ絞めでくっつきますので大丈夫です。）

![123](images/yw123.jpg)

M1.7のトルクスねじをつけます。キットにはねじ頭が【小さいねじ】と【平らなねじ】が同梱されていますが、そのうちの【頭の小さいねじ】を使用します。

![124](images/yw124.jpg)

ケース裏から見て、この２個所をねじ止めします。締め付けすぎにご注意ください。

![125](images/yw125.jpg)

完成したケースを本体に取付けます。ケース裏側のセンサー収納部にボール基板が入ります。  
矢印で示すボール基板がケース中央くらいにくるようにしながら、上からゆっくりとはめます。引っ掛かりがある場合、無理に押し込まず、一度引き抜いて再度入れ直してください。

![126](images/yw126.jpg)

それほど力を入れなくても最後まで入るはずです。

![127](images/yw127.jpg)

本体裏から確認するとメイン基板とボール基板の間に、矢印で示すような隙間が出来ている場合があります。

![128](images/yw128.jpg)

その時は、軽～くケース手前（指マークの方向）から押します。力を入れすぎるとL字コンスルーが破損する可能性があるので、軽く押してください。  
下写真のように隙間がなくなれば、青丸部のねじ穴が合うと思います。

![129](images/yw129.jpg)

キットに同梱のM1.7トルクスねじの【頭が平らなねじ】２本を本体裏から絞めます。この時ボール保持ケースが回転しないように指で抑えながらねじを絞めてください。

![130](images/yw130.jpg)

完成間近です！お好みのキースイッチをはめ込んでいきます。

![131](images/yw131.jpg)

最後に34mmトラックボールをケースに押し込んで完成です！  
お疲れ様でした。

![132](images/yw132.jpg)


